# docker-compose.override.yml
version: '3.8'

services:
  web:
    command: >
      sh -c "
        python manage.py migrate &&
        python manage.py collectstatic --noinput &&
        python manage.py runserver 0.0.0.0:8000
      "
    volumes:
      - .:/app
      - media_data:/app/media
      - static_data:/app/staticfiles
      - /app/__pycache__
      - /app/.pytest_cache
    env_file:
      - .env
    stdin_open: true
    tty: true

  worker:
    volumes:
      - .:/app
      - media_data:/app/media
      - /app/__pycache__
    env_file:
      - .env

  postgres:
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./docker/postgres/init.sql:/docker-entrypoint-initdb.d/init.sql:ro
    environment:
      - POSTGRES_HOST_AUTH_METHOD=trust

  redis:
    command: redis-server --save ""