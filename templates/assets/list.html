<!-- templates/assets/list.html - COMPLETE REFACTORING -->
{% extends "base.html" %}
{% load widget_tweaks %}

{% block title %}Assets - Solidus{% endblock %}

{% block content %}
    {% include 'partials/content/list_header.html' with title="Assets" subtitle="Manage your digital assets" stats=asset_stats actions=header_actions %}

    {% include 'partials/content/search_filter.html' with show_search=True search_placeholder="Search assets..." filter_fields=filter_form.visible_fields use_htmx=True target_id="assets-container" grid_cols=5 %}

    <div class="flex items-center justify-between mb-6">
        {% include 'partials/content/view_toggle.html' %}
        {% include 'partials/content/bulk_actions.html' with bulk_actions=bulk_actions %}
    </div>

    <div id="assets-container" data-view-container>
        {% if assets %}
            {% for asset in assets %}
                {% if view_mode == 'list' %}
                    {% include 'partials/media/asset_list_item.html' with asset=asset show_checkbox=True %}
                {% else %}
                    {% include 'partials/media/asset_card.html' with asset=asset show_checkbox=True show_meta=True %}
                {% endif %}
            {% endfor %}
        {% else %}
            {% include 'partials/content/empty_state.html' with icon="fas fa-images" title="No assets found" message="Upload your first asset to get started" action_url_name="assets:create" action_text="Upload Asset" action_icon="fas fa-plus" secondary_action_url_name="assets:bulk_upload" secondary_action_text="Bulk Upload" secondary_action_icon="fas fa-upload" %}
        {% endif %}
    </div>

    {% include 'partials/pagination.html' %}

    <!-- Bulk Actions Modal -->
    <div id="bulk-actions-modal"></div>
{% endblock %}

{% block extra_js %}
<script>
// Initialize bulk selection
document.addEventListener('DOMContentLoaded', function() {
    const selectAll = document.getElementById('select-all');
    const assetCheckboxes = document.querySelectorAll('.item-checkbox');
    const bulkActionsBar = document.getElementById('bulk-actions-bar');

    if (selectAll) {
        selectAll.addEventListener('change', function() {
            assetCheckboxes.forEach(checkbox => {
                checkbox.checked = this.checked;
            });
            updateBulkActions();
        });
    }

    assetCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', updateBulkActions);
    });

    function updateBulkActions() {
        const selectedCount = document.querySelectorAll('.item-checkbox:checked').length;
        const bulkBar = document.getElementById('bulk-actions-bar');
        const countElement = document.getElementById('selected-count');

        if (selectedCount > 0) {
            bulkBar.classList.remove('hidden');
            countElement.textContent = selectedCount;
        } else {
            bulkBar.classList.add('hidden');
        }
    }
});
</script>
{% endblock %}