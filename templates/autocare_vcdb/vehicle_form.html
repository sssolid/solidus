<!-- templates/autocare_vcdb/vehicle_form.html -->
{% extends 'autocare_vcdb/base.html' %}
{% load static %}
{% load i18n %}
{% load widget_tweaks %}

{% block title %}{% if form.instance.pk %}Edit{% else %}Add{% endif %} Vehicle{% endblock %}

{% block breadcrumb %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'automotive:dashboard' %}">Dashboard</a></li>
        <li class="breadcrumb-item"><a href="{% url 'automotive:vehicle_list' %}">Vehicles</a></li>
        <li class="breadcrumb-item active">
            {% if form.instance.pk %}Edit Vehicle{% else %}Add Vehicle{% endif %}
        </li>
    </ol>
</nav>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 mx-auto">
        <div class="card">
            <div class="card-header">
                <h5>
                    <i class="bi bi-{% if form.instance.pk %}pencil{% else %}plus{% endif %}"></i>
                    {% if form.instance.pk %}Edit Vehicle{% else %}Add New Vehicle{% endif %}
                </h5>
            </div>
            <div class="card-body">
                <form method="post" novalidate>
                    {% csrf_token %}

                    {% if form.non_field_errors %}
                        <div class="alert alert-danger">
                            {{ form.non_field_errors }}
                        </div>
                    {% endif %}

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="{{ form.base_vehicle.id_for_label }}" class="form-label">
                                Base Vehicle <span class="text-danger">*</span>
                            </label>
                            {{ form.base_vehicle|add_class:"form-select" }}
                            {% if form.base_vehicle.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.base_vehicle.errors.0 }}
                                </div>
                            {% endif %}
                            <div class="form-text">Select the year/make/model combination</div>
                        </div>

                        <div class="col-md-6">
                            <label for="{{ form.submodel.id_for_label }}" class="form-label">
                                Submodel <span class="text-danger">*</span>
                            </label>
                            {{ form.submodel|add_class:"form-select" }}
                            {% if form.submodel.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.submodel.errors.0 }}
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="{{ form.region.id_for_label }}" class="form-label">
                                Region <span class="text-danger">*</span>
                            </label>
                            {{ form.region|add_class:"form-select" }}
                            {% if form.region.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.region.errors.0 }}
                                </div>
                            {% endif %}
                        </div>

                        <div class="col-md-6">
                            <label for="{{ form.source.id_for_label }}" class="form-label">
                                Source
                            </label>
                            {{ form.source|add_class:"form-control" }}
                            {% if form.source.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.source.errors.0 }}
                                </div>
                            {% endif %}
                            <div class="form-text">Data source identifier (optional)</div>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="{{ form.publication_stage.id_for_label }}" class="form-label">
                                Publication Stage <span class="text-danger">*</span>
                            </label>
                            {{ form.publication_stage|add_class:"form-select" }}
                            {% if form.publication_stage.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.publication_stage.errors.0 }}
                                </div>
                            {% endif %}
                        </div>

                        <div class="col-md-6">
                            <label for="{{ form.publication_stage_source.id_for_label }}" class="form-label">
                                Publication Stage Source <span class="text-danger">*</span>
                            </label>
                            {{ form.publication_stage_source|add_class:"form-control" }}
                            {% if form.publication_stage_source.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.publication_stage_source.errors.0 }}
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="d-flex justify-content-between">
                        <a href="{% if form.instance.pk %}{% url 'automotive:vehicle_detail' form.instance.vehicle_id %}{% else %}{% url 'automotive:vehicle_list' %}{% endif %}"
                           class="btn btn-secondary">
                            <i class="bi bi-x-circle"></i> Cancel
                        </a>

                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle"></i>
                            {% if form.instance.pk %}Update Vehicle{% else %}Create Vehicle{% endif %}
                        </button>
                    </div>
                </form>
            </div>
        </div>

        {% if form.instance.pk %}
            <div class="card mt-4">
                <div class="card-header">
                    <h6><i class="bi bi-info-circle"></i> Vehicle Information</h6>
                </div>
                <div class="card-body">
                    <dl class="row">
                        <dt class="col-sm-3">Vehicle ID:</dt>
                        <dd class="col-sm-9">{{ form.instance.vehicle_id }}</dd>

                        <dt class="col-sm-3">Created:</dt>
                        <dd class="col-sm-9">
                            {{ form.instance.created_at|date:"M d, Y H:i" }}
                            {% if form.instance.created_by %}
                                by {{ form.instance.created_by }}
                            {% endif %}
                        </dd>

                        <dt class="col-sm-3">Last Updated:</dt>
                        <dd class="col-sm-9">
                            {{ form.instance.updated_at|date:"M d, Y H:i" }}
                            {% if form.instance.updated_by %}
                                by {{ form.instance.updated_by }}
                            {% endif %}
                        </dd>
                    </dl>
                </div>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add any form-specific JavaScript here
    // For example, dynamic loading of submodels based on base vehicle selection

    const baseVehicleSelect = document.getElementById('{{ form.base_vehicle.id_for_label }}');
    if (baseVehicleSelect) {
        baseVehicleSelect.addEventListener('change', function() {
            // Could trigger HTMX request to update related fields
            console.log('Base vehicle changed:', this.value);
        });
    }
});
</script>
{% endblock %}