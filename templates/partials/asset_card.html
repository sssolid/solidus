{# templates/partials/asset_card.htm #}
{% load static %}

<div class="asset-card bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-all duration-300 group">
    <!-- Asset Preview -->
    <div class="aspect-w-16 aspect-h-9 bg-gray-100 relative">
        {% if asset.asset_type == 'image' %}
            <img src="{{ asset.thumbnail_url }}"
                 alt="{{ asset.title }}"
                 class="w-full h-48 object-cover">
        {% elif asset.asset_type == 'video' %}
            <div class="w-full h-48 bg-gray-900 flex items-center justify-center relative">
                {% if asset.thumbnail_url %}
                    <img src="{{ asset.thumbnail_url }}"
                         alt="{{ asset.title }}"
                         class="w-full h-full object-cover">
                {% endif %}
                <div class="absolute inset-0 flex items-center justify-center">
                    <div class="bg-black bg-opacity-50 rounded-full p-4">
                        <i class="fas fa-play text-white text-2xl"></i>
                    </div>
                </div>
            </div>
        {% else %}
            <div class="w-full h-48 bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center">
                {% if asset.asset_type == 'document' %}
                    <i class="fas fa-file-pdf text-red-500 text-4xl"></i>
                {% elif asset.asset_type == 'archive' %}
                    <i class="fas fa-file-archive text-orange-500 text-4xl"></i>
                {% else %}
                    <i class="fas fa-file text-gray-500 text-4xl"></i>
                {% endif %}
            </div>
        {% endif %}

        <!-- File Type Badge -->
        <div class="absolute top-2 left-2">
            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium
                {% if asset.asset_type == 'image' %}bg-green-100 text-green-800
                {% elif asset.asset_type == 'video' %}bg-purple-100 text-purple-800
                {% elif asset.asset_type == 'document' %}bg-blue-100 text-blue-800
                {% elif asset.asset_type == 'archive' %}bg-orange-100 text-orange-800
                {% else %}bg-gray-100 text-gray-800{% endif %}">
                {{ asset.get_asset_type_display|upper }}
            </span>
        </div>

        <!-- Status Indicators -->
        <div class="absolute top-2 right-2 space-y-1">
            {% if not asset.is_active %}
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                    Inactive
                </span>
            {% endif %}

            {% if not asset.is_public and user.is_employee %}
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                    Private
                </span>
            {% endif %}

            {% if asset.is_featured %}
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-500 text-white">
                    <i class="fas fa-star text-xs"></i>
                </span>
            {% endif %}
        </div>

        <!-- Quick Actions Overlay -->
        <div class="absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity">
            <div class="flex space-x-1">
                {% if user.is_employee %}
                    <a href="{% url 'assets:edit' asset.pk %}"
                       class="bg-blue-600 text-white p-2 rounded-full hover:bg-blue-700 transition"
                       title="Edit Asset">
                        <i class="fas fa-edit text-sm"></i>
                    </a>
                {% endif %}

                <a href="{{ asset.file.url }}"
                   download="{{ asset.title }}"
                   class="bg-green-600 text-white p-2 rounded-full hover:bg-green-700 transition"
                   title="Download">
                    <i class="fas fa-download text-sm"></i>
                </a>

                <a href="{% url 'assets:detail' asset.pk %}"
                   class="bg-gray-800 text-white p-2 rounded-full hover:bg-gray-900 transition"
                   title="View Details">
                    <i class="fas fa-eye text-sm"></i>
                </a>
            </div>
        </div>
    </div>

    <!-- Asset Info -->
    <div class="p-4">
        <!-- Title -->
        <h3 class="text-lg font-semibold text-gray-900 mb-2 line-clamp-2">
            <a href="{% url 'assets:detail' asset.pk %}" class="hover:text-blue-600 transition">
                {{ asset.title }}
            </a>
        </h3>

        <!-- Description -->
        {% if asset.description %}
            <p class="text-sm text-gray-600 mb-3 line-clamp-2">
                {{ asset.description|truncatewords:15 }}
            </p>
        {% endif %}

        <!-- Metadata -->
        <div class="space-y-2 mb-3">
            <!-- File Size -->
            <div class="flex items-center justify-between text-sm">
                <span class="text-gray-500">Size:</span>
                <span class="font-medium">{{ asset.file_size|filesizeformat }}</span>
            </div>

            <!-- Dimensions (for images/videos) -->
            {% if asset.width and asset.height %}
                <div class="flex items-center justify-between text-sm">
                    <span class="text-gray-500">Dimensions:</span>
                    <span class="font-medium">{{ asset.width }}Ã—{{ asset.height }}</span>
                </div>
            {% endif %}

            <!-- Duration (for videos/audio) -->
            {% if asset.duration %}
                <div class="flex items-center justify-between text-sm">
                    <span class="text-gray-500">Duration:</span>
                    <span class="font-medium">{{ asset.duration }}</span>
                </div>
            {% endif %}
        </div>

        <!-- Tags -->
        {% if asset.tags.exists %}
            <div class="flex flex-wrap gap-1 mb-3">
                {% for tag in asset.tags.all|slice:":4" %}
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                        {{ tag.name }}
                    </span>
                {% endfor %}
                {% if asset.tags.count > 4 %}
                    <span class="text-xs text-gray-500">+{{ asset.tags.count|add:"-4" }} more</span>
                {% endif %}
            </div>
        {% endif %}

        <!-- Associated Products -->
        {% if asset.products.exists %}
            <div class="border-t border-gray-200 pt-3 mb-3">
                <div class="flex items-center text-sm text-gray-600 mb-1">
                    <i class="fas fa-box mr-1"></i>
                    <span>Used in {{ asset.products.count }} product{{ asset.products.count|pluralize }}</span>
                </div>
                <div class="flex flex-wrap gap-1">
                    {% for product in asset.products.all|slice:":2" %}
                        <a href="{% url 'products:detail' product.pk %}"
                           class="text-xs text-blue-600 hover:text-blue-800 bg-blue-50 px-2 py-1 rounded">
                            {{ product.name|truncatewords:3 }}
                        </a>
                    {% endfor %}
                    {% if asset.products.count > 2 %}
                        <span class="text-xs text-gray-500">+{{ asset.products.count|add:"-2" }} more</span>
                    {% endif %}
                </div>
            </div>
        {% endif %}

        <!-- Collection Actions (if in collection context) -->
        {% if show_collection_actions and collection %}
            <div class="border-t border-gray-200 pt-3">
                <button hx-delete="{% url 'assets:collection_remove_asset' slug=collection.slug asset_id=asset.pk %}"
                        hx-target="closest .asset-card"
                        hx-swap="outerHTML"
                        hx-confirm="Remove this asset from the collection?"
                        class="text-sm text-red-600 hover:text-red-800 font-medium">
                    <i class="fas fa-times mr-1"></i>
                    Remove from Collection
                </button>
            </div>
        {% endif %}
    </div>

    <!-- Footer -->
    <div class="bg-gray-50 px-4 py-3 flex justify-between items-center text-sm">
        <div class="flex items-center text-gray-500">
            <i class="fas fa-user mr-1"></i>
            {{ asset.created_by.get_full_name|default:asset.created_by.username }}
        </div>

        <div class="text-gray-500">
            {{ asset.created_at|timesince }} ago
        </div>
    </div>

    <!-- Download Counter -->
    {% if asset.download_count > 0 %}
        <div class="absolute top-12 left-2 bg-black bg-opacity-75 text-white text-xs px-2 py-1 rounded">
            <i class="fas fa-download mr-1"></i>
            {{ asset.download_count }}
        </div>
    {% endif %}
</div>

<style>
    .asset-card {
        position: relative;
    }
    .asset-card:hover {
        transform: translateY(-2px);
    }
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>