<!-- templates/partials/forms/multiple_file_input.html -->
<div class="multiple-file-upload-container" x-data="multipleFileUpload()">
    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors"
         :class="{ 'border-blue-400 bg-blue-50': dragover }"
         @dragover.prevent="dragover = true"
         @dragleave.prevent="dragover = false"
         @drop.prevent="handleDrop($event)"
         @click="$refs.fileInput.click()">

        <div class="mx-auto h-12 w-12 text-gray-400 mb-4">
            <i class="fas fa-cloud-upload-alt text-4xl"></i>
        </div>

        <div class="text-sm text-gray-600">
            <span class="font-medium text-blue-600 hover:text-blue-500 cursor-pointer">
                Click to upload files
            </span>
            or drag and drop
        </div>

        <p class="text-xs text-gray-500 mt-2">
            Select multiple files to upload
        </p>
    </div>

    <input type="file"
           x-ref="fileInput"
           multiple
           class="hidden"
           @change="handleFileSelect($event)">

    <div x-show="files.length > 0" class="mt-4 space-y-2">
        <template x-for="(file, index) in files" :key="index">
            <div class="flex items-center p-3 bg-gray-50 rounded-md">
                <i class="fas fa-file text-gray-400 mr-3"></i>
                <div class="flex-1">
                    <p class="text-sm font-medium text-gray-900" x-text="file.name"></p>
                    <p class="text-xs text-gray-500" x-text="formatFileSize(file.size)"></p>
                </div>
                <button type="button"
                        @click="removeFile(index)"
                        class="text-red-500 hover:text-red-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </template>
    </div>

    <div x-show="files.length > 0" class="mt-4">
        <button type="button"
                @click="uploadFiles()"
                class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition">
            Upload <span x-text="files.length"></span> Files
        </button>
    </div>
</div>

<script>
function multipleFileUpload() {
    return {
        files: [],
        dragover: false,

        handleDrop(event) {
            this.dragover = false;
            const files = Array.from(event.dataTransfer.files);
            this.addFiles(files);
        },

        handleFileSelect(event) {
            const files = Array.from(event.target.files);
            this.addFiles(files);
        },

        addFiles(newFiles) {
            newFiles.forEach(file => {
                if (!this.files.some(f => f.name === file.name && f.size === file.size)) {
                    this.files.push(file);
                }
            });
        },

        removeFile(index) {
            this.files.splice(index, 1);
        },

        formatFileSize(bytes) {
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            if (bytes === 0) return '0 Bytes';
            const i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));
            return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];
        },

        uploadFiles() {
            // Implementation depends on your upload endpoint
            console.log('Uploading files:', this.files);
        }
    }
}
</script>