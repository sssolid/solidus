<!-- templates/partials/forms/tags_input.html -->
<div class="tags-input-container" x-data="tagsInput('{{ field.value|default:'' }}')">
    <div class="border border-gray-300 rounded-md p-2 min-h-[2.5rem] focus-within:border-blue-500 focus-within:ring-1 focus-within:ring-blue-500">
        <div class="flex flex-wrap gap-1">
            <template x-for="(tag, index) in tags" :key="index">
                <span class="inline-flex items-center bg-blue-100 text-blue-800 text-sm px-2 py-1 rounded">
                    <span x-text="tag"></span>
                    <button type="button"
                            @click="removeTag(index)"
                            class="ml-1 text-blue-600 hover:text-blue-800">
                        <i class="fas fa-times text-xs"></i>
                    </button>
                </span>
            </template>
            <input type="text"
                   x-model="currentTag"
                   @keydown.enter.prevent="addTag()"
                   @keydown.comma.prevent="addTag()"
                   @keydown.backspace="handleBackspace()"
                   placeholder="Type and press Enter to add tags"
                   class="flex-1 min-w-[120px] border-0 p-0 focus:ring-0 text-sm">
        </div>
    </div>

    <input type="hidden"
           name="{{ field.html_name }}"
           :value="tags.join(',')"
           id="{{ field.id_for_label }}">

    <div class="mt-1 text-xs text-gray-500">
        Press Enter or comma to add tags
    </div>
</div>

<script>
function tagsInput(initialValue) {
    return {
        tags: initialValue ? initialValue.split(',').map(t => t.trim()).filter(t => t) : [],
        currentTag: '',

        addTag() {
            const tag = this.currentTag.trim();
            if (tag && !this.tags.includes(tag)) {
                this.tags.push(tag);
                this.currentTag = '';
            }
        },

        removeTag(index) {
            this.tags.splice(index, 1);
        },

        handleBackspace() {
            if (this.currentTag === '' && this.tags.length > 0) {
                this.tags.pop();
            }
        }
    }
}
</script>