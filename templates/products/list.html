<!-- templates/products/list.html - COMPLETE REFACTORING -->
{% extends "base.html" %}
{% load widget_tweaks %}

{% block title %}Products - Solidus{% endblock %}

{% block content %}
    {% include 'partials/content/list_header.html' with title="Products" subtitle="Manage your product catalog" stats=product_stats actions=header_actions %}

    {% include 'partials/content/search_filter.html' with show_search=True search_placeholder="Search products..." filter_fields=filter_form.visible_fields use_htmx=True target_id="products-container" grid_cols=4 %}

    <div class="flex items-center justify-between mb-6">
        {% include 'partials/content/view_toggle.html' %}

        <div class="flex space-x-2">
            <select onchange="handleSortChange(this.value)" class="text-sm border-gray-300 rounded-md">
                <option value="name">Name A-Z</option>
                <option value="-name">Name Z-A</option>
                <option value="-created_at">Newest First</option>
                <option value="created_at">Oldest First</option>
            </select>
        </div>
    </div>

    <div id="products-container" data-view-container>
        {% if products %}
            {% for product in products %}
                {% if view_mode == 'list' %}
                    {% include 'partials/products/product_list_item.html' with product=product show_pricing=True %}
                {% else %}
                    {% include 'partials/products/product_card.html' with product=product show_quick_actions=True show_pricing=True %}
                {% endif %}
            {% endfor %}
        {% else %}
            {% include 'partials/content/empty_state.html' with icon="fas fa-box" title="No products found" message="Create your first product to get started" action_url_name="products:create" action_text="Add Product" action_icon="fas fa-plus" %}
        {% endif %}
    </div>

    {% include 'partials/pagination.html' %}
{% endblock %}